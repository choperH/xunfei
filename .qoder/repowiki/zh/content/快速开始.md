# 快速开始

<cite>
**本文档引用的文件**
- [大模型中文语音识别.py](file://大模型中文语音识别.py)
</cite>

## 目录
1. [简介](#简介)
2. [环境要求](#环境要求)
3. [安装依赖](#安装依赖)
4. [讯飞开放平台配置](#讯飞开放平台配置)
5. [代码配置](#代码配置)
6. [音频文件准备](#音频文件准备)
7. [运行脚本](#运行脚本)
8. [预期输出](#预期输出)
9. [常见问题排查](#常见问题排查)
10. [总结](#总结)

## 简介

本指南将帮助开发者快速在本地环境中运行讯飞开放平台的中文语音识别脚本。该脚本使用WebSocket协议连接到讯飞的语音识别服务，实现流式语音转文字功能。

## 环境要求

### 系统要求
- **操作系统**: Windows 10/11 或 Linux/macOS
- **Python版本**: Python 3.7+
- **内存**: 建议至少2GB可用内存
- **网络**: 需要稳定的互联网连接

### 开发工具
- 文本编辑器（推荐VS Code、PyCharm或Notepad++）
- 命令行终端（Windows PowerShell、CMD或Linux Terminal）

## 安装依赖

### 第三方库列表

根据代码注释，需要安装以下Python第三方库：

```bash
cffi==1.12.3
gevent==1.4.0
greenlet==0.4.15
pycparser==2.19
six==1.12.0
websocket==0.2.1
websocket-client==0.56.0
```

### 安装命令

#### 方法一：使用requirements.txt（推荐）
```bash
# 创建虚拟环境（可选但推荐）
python -m venv speech_env
# 激活虚拟环境
# Windows:
speech_env\Scripts\activate
# Linux/macOS:
source speech_env/bin/activate

# 安装所有依赖
pip install cffi==1.12.3 gevent==1.4.0 greenlet==0.4.15 pycparser==2.19 six==1.12.0 websocket==0.2.1 websocket-client==0.56.0
```

#### 方法二：单独安装每个库
```bash
pip install cffi==1.12.3
pip install gevent==1.4.0
pip install greenlet==0.4.15
pip install pycparser==2.19
pip install six==1.12.0
pip install websocket==0.2.1
pip install websocket-client==0.56.0
```

#### 验证安装
```bash
# 检查Python版本
python --version

# 验证依赖库安装
python -c "import websocket; import base64; import datetime; import hashlib; import hmac; import json; import ssl; print('依赖库安装成功')"
```

## 讯飞开放平台配置

### 注册账号

1. 打开浏览器访问 [讯飞开放平台](https://www.xfyun.cn/)
2. 点击右上角"登录/注册"按钮
3. 使用手机号或邮箱注册新账号
4. 完成实名认证（部分功能需要）

### 创建应用

1. 登录后进入"控制台"
2. 点击"我的应用" -> "创建应用"
3. 应用类型选择"语音听写（流式）"
4. 填写应用信息：
   - 应用名称：自定义名称
   - 应用描述：简要说明
   - 应用类型：语音识别
5. 点击"创建应用"

### 获取API凭证

创建应用后，在应用详情页面可以找到以下关键信息：

- **APPID**: 应用唯一标识符
- **APIKey**: 用于身份验证的密钥
- **APISecret**: 用于生成签名的密钥

### 平台服务配置

1. 在应用控制台中找到"语音听写（流式）"服务
2. 进入"服务管理" -> "个性化热词"设置
3. 添加常用词汇以提高识别准确率
4. 如果需要方言识别，可在"识别语种列表"中添加相应方言

## 代码配置

### 修改主程序

打开 `大模型中文语音识别.py` 文件，找到以下代码段：

```python
if __name__ == "__main__":
    # 测试时候在此处正确填写相关信息即可运行
    
    wsParam = Ws_Param(APPID='', APISecret='',
                       APIKey='',
                       AudioFile=r'')
```

### 填写配置参数

将获取的API凭证填入相应位置：

```python
if __name__ == "__main__":
    # 测试时候在此处正确填写相关信息即可运行
    
    wsParam = Ws_Param(
        APPID='您的APPID',
        APIKey='您的APIKey',
        APISecret='您的APISecret',
        AudioFile=r'您的音频文件路径.wav'
    )
```

### 参数说明

- **APPID**: 讯飞开放平台分配的应用唯一标识符
- **APIKey**: 用于身份验证的API密钥
- **APISecret**: 用于生成安全签名的密钥
- **AudioFile**: 本地音频文件的完整路径，必须是WAV格式，采样率为16kHz

## 音频文件准备

### 格式要求

- **文件格式**: WAV
- **采样率**: 16kHz
- **位深度**: 16bit
- **声道**: 单声道（Mono）
- **文件大小**: 建议不超过10MB

### 转换工具

如果您的音频文件不符合要求，可以使用以下工具进行转换：

#### Windows用户
- [Audacity](https://www.audacityteam.org/) - 免费开源音频编辑软件
- [Format Factory](http://www.pcfreetime.com/formatfactory/) - 音频格式转换工具

#### Linux用户
```bash
# 使用ffmpeg转换音频格式
sudo apt-get install ffmpeg
ffmpeg -i input.mp3 -ar 16000 -ac 1 -ab 16k -f wav output.wav
```

#### macOS用户
```bash
# 使用Homebrew安装FFmpeg
brew install ffmpeg
ffmpeg -i input.mp3 -ar 16000 -ac 1 -ab 16k -f wav output.wav
```

### 示例音频文件

建议使用以下格式的音频文件进行测试：
- 纯净的单人讲话录音
- 清晰的普通话发音
- 适当的背景噪音控制

## 运行脚本

### 基本运行命令

```bash
# 在项目目录下运行
python 大模型中文语音识别.py
```

### 运行环境检查

确保以下条件满足：
1. Python环境已正确配置
2. 所有依赖库已安装
3. 音频文件路径正确且可访问
4. 网络连接正常

### 调试模式

如果遇到问题，可以启用调试模式：

```python
# 在第190行附近，修改以下代码
websocket.enableTrace(True)  # 启用详细日志输出
```

重新运行脚本以查看详细的连接和通信信息。

## 预期输出

### 控制台输出格式

运行成功后，控制台将逐段打印出识别的中文文本：

```
正在连接到讯飞语音识别服务...
[时间戳] WebSocket连接已建立
[时间戳] 开始发送音频数据...
[时间戳] 识别结果: 这是一段测试语音
[时间戳] 识别结果: 我们正在测试语音识别功能
[时间戳] 识别结果: 您可以继续说话直到完成
[时间戳] 识别完成，正在关闭连接...
```

### 输出特点

- 每个识别结果都是独立的文本片段
- 结果按时间顺序排列
- 最后会显示完整的识别文本
- 连接结束后会显示关闭状态

### 性能指标

- **响应时间**: 通常在1-3秒内返回第一个识别结果
- **识别准确率**: 取决于音频质量和网络状况
- **并发处理**: 支持实时流式处理

## 常见问题排查

### 权限错误

**问题症状**:
```
PermissionError: [Errno 13] Permission denied: 'your_audio_file.wav'
```

**解决方案**:
1. 检查音频文件路径是否正确
2. 确认文件具有读取权限
3. 使用绝对路径而非相对路径
4. 确保文件未被其他程序占用

### 连接失败

**问题症状**:
```
Connection refused: iat.xf-yun.com:80
```

**解决方案**:
1. 检查网络连接是否正常
2. 确认防火墙未阻止Python程序
3. 验证讯飞开放平台服务状态
4. 尝试使用代理服务器

### 认证错误

**问题症状**:
```
请求错误：10101
```

**解决方案**:
1. 重新检查API凭证是否正确
2. 确认APPID、APIKey、APISecret无误
3. 验证应用状态是否为"已发布"
4. 检查API配额是否已用完

### 音频格式错误

**问题症状**:
```
Invalid audio format or sampling rate
```

**解决方案**:
1. 确认音频文件为WAV格式
2. 检查采样率是否为16kHz
3. 确认声道为单声道
4. 验证文件大小是否符合要求

### 网络超时

**问题症状**:
```
TimeoutError: [Errno 110] Connection timed out
```

**解决方案**:
1. 检查网络稳定性
2. 尝试减少音频文件大小
3. 使用更稳定的网络连接
4. 考虑使用有线网络替代无线网络

### 内存不足

**问题症状**:
```
MemoryError: Unable to allocate memory
```

**解决方案**:
1. 关闭其他占用内存的程序
2. 减少音频文件大小
3. 分割大文件为多个小文件
4. 增加系统虚拟内存

## 总结

通过本指南，您应该能够：

1. **成功配置开发环境**：安装所有必要的Python库和依赖
2. **正确配置讯飞API**：获取并填写正确的API凭证
3. **准备合适的音频文件**：确保音频格式符合要求
4. **运行语音识别脚本**：理解运行流程和预期输出
5. **解决常见问题**：具备基本的故障排除能力

### 下一步建议

- **优化识别效果**：通过设置个性化热词提高识别准确率
- **批量处理**：扩展脚本以支持批量音频文件处理
- **集成应用**：将语音识别功能集成到实际应用场景中
- **监控性能**：添加日志记录和性能监控功能

### 注意事项

1. **API限制**: 注意讯飞开放平台的免费额度限制
2. **数据安全**: 不要在生产环境中暴露API凭证
3. **版权合规**: 确保使用的音频文件不侵犯版权
4. **定期更新**: 关注讯飞API的更新和变更

通过遵循本指南的步骤，您应该能够在本地环境中成功运行讯飞中文语音识别脚本，并获得高质量的语音转文字结果。